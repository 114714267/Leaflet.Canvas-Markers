"use strict";L.CanvasIconLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t){L.setOptions(this,t)},setOptions:function(t){return L.setOptions(this,t),this._canvas&&this._updateOptions(),this.redraw()},redraw:function(){this._redraw(!0)},addMarker:function(t){L.Util.stamp(t),this._markers||(this._markers={}),this._markers[t._leaflet_id]=t,this._drawMarker(t)},removeMarker:function(t,a){delete this._markers[t._leaflet_id],a&&this._redraw(!0)},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this)},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas)},addTo:function(t){return t.addLayer(this),this},_drawMarker:function(t){var a=this._context,i=this._map.latLngToContainerPoint(t.getLatLng());t.canvas_img?a.drawImage(t.canvas_img,i.x,i.y):(t.canvas_img=new Image,t.canvas_img.src=t.options.icon.options.iconUrl,t.canvas_img.onload=function(){a.drawImage(t.canvas_img,i.x-t.options.icon.options.iconAnchor[0],i.y-t.options.icon.options.iconAnchor[1])})},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y,this._redraw()},_redraw:function(t){this._map&&(t&&this._context.clearRect(0,0,this._canvas.width,this._canvas.height),Object.keys(this._markers).forEach(function(t){this._drawMarker(this._markers[t])},this))},_initCanvas:function(){this._canvas=L.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer");var t=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this._canvas.style[t]="50% 50%";var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y,this._context=this._canvas.getContext("2d");var i=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(i?"animated":"hide"))},_updateOptions:function(){}}),L.canvasIconLayer=function(t){return new L.CanvasIconLayer(t)};