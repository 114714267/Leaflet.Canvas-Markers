"use strict";L.CanvasIconLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(a){L.setOptions(this,a)},setOptions:function(a){return L.setOptions(this,a),this._canvas&&this._updateOptions(),this.redraw()},redraw:function(){this._redraw(!0)},addMarker:function(a){L.Util.stamp(a),this._markers||(this._markers={}),this._markers[a._leaflet_id]=a,this._drawMarker(a)},addLayer:function(a){"markerPane"==a.options.pane&&a.options.icon?this.addMarker(a):console.error("Layer isn't a marker")},removeLayer:function(a){this.removeMarker(a,!0)},removeMarker:function(a,t){delete this._markers[a._leaflet_id],t&&this._redraw(!0)},onAdd:function(a){this._map=a,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):a._panes.overlayPane.appendChild(this._canvas),a.on("moveend",this._reset,this)},onRemove:function(a){this.options.pane?this.getPane().removeChild(this._canvas):a.getPanes().overlayPane.removeChild(this._canvas)},addTo:function(a){return a.addLayer(this),this},_drawMarker:function(a){var t=this,i=this._map.latLngToContainerPoint(a.getLatLng());a.canvas_img?t._drawImage(a,i):(a.canvas_img=new Image,a.canvas_img.src=a.options.icon.options.iconUrl,a.canvas_img.onload=function(){t._drawImage(a,i)})},_drawImage:function(a,t){this._context.drawImage(a.canvas_img,t.x-a.options.icon.options.iconAnchor[0],t.y-a.options.icon.options.iconAnchor[1],a.options.icon.options.iconSize[0],a.options.icon.options.iconSize[1])},_reset:function(){var a=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,a);var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y,this._redraw()},_redraw:function(a){this._map&&(a&&this._context.clearRect(0,0,this._canvas.width,this._canvas.height),Object.keys(this._markers).forEach(function(a){this._drawMarker(this._markers[a])},this))},_initCanvas:function(){this._canvas=L.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer");var a=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this._canvas.style[a]="50% 50%";var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y,this._context=this._canvas.getContext("2d");var i=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(i?"animated":"hide"))},_updateOptions:function(){}}),L.canvasIconLayer=function(a){return new L.CanvasIconLayer(a)};