!function(t){var n={};function a(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=t,a.c=n,a.d=function(t,n,i){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var e in t)a.d(i,e,function(n){return t[n]}.bind(null,e));return i},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=4)}([,,,function(t,n,a){"use strict";t.exports=function(t){var n=(t.Layer?t.Layer:t.Class).extend({initialize:function(n){t.setOptions(this,n),this._onClickListeners=[],this._onHoverListeners=[]},setOptions:function(n){return t.setOptions(this,n),this._canvas&&this._updateOptions(),this.redraw()},redraw:function(){this._redraw(!0)},addMarkers:function(t){var n=this,a=[],i=[];t.forEach(function(t){if("markerPane"==t.options.pane&&t.options.icon){var e=t.getLatLng(),o=n._map.getBounds().contains(e),r=n._addMarker(t,e,o);!0===o&&a.push(r[0]),i.push(r[1])}else console.error("Layer isn't a marker")}),n._markers.load(a),n._latlngMarkers.load(i)},addMarker:function(t){var n=t.getLatLng(),a=this._map.getBounds().contains(n),i=this._addMarker(t,n,a);!0===a&&this._markers.insert(i[0]),this._latlngMarkers.insert(i[1])},addLayer:function(t){"markerPane"==t.options.pane&&t.options.icon?this.addMarker(t):console.error("Layer isn't a marker")},addLayers:function(t){this.addMarkers(t)},removeLayer:function(t){this.removeMarker(t,!0)},removeMarker:function(t,n){t.minX&&(t=t.data);var a=t.getLatLng(),i=this._map.getBounds().contains(a);this._latlngMarkers.remove({minX:a.lng,minY:a.lat,maxX:a.lng,maxY:a.lat,data:t},function(t,n){return t.data._leaflet_id===n.data._leaflet_id}),this._latlngMarkers.total--,this._latlngMarkers.dirty++,!0===i&&!0===n&&this._redraw(!0)},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.on("resize",this._reset,this),t.on("click",this._executeListeners,this),t.on("mousemove",this._executeListeners,this)},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas)},addTo:function(t){return t.addLayer(this),this},_addMarker:function(n,a,i){n._map=this._map,this._markers||(this._markers=new rbush),this._latlngMarkers||(this._latlngMarkers=new rbush,this._latlngMarkers.dirty=0,this._latlngMarkers.total=0),t.Util.stamp(n);var e=this._map.latLngToContainerPoint(a),o=n.options.icon.options.iconSize,r=o[0]/2,s=o[1]/2,c=[{minX:e.x-r,minY:e.y-s,maxX:e.x+r,maxY:e.y+s,data:n},{minX:a.lng,minY:a.lat,maxX:a.lng,maxY:a.lat,data:n}];return this._latlngMarkers.dirty++,this._latlngMarkers.total++,!0===i&&this._drawMarker(n,e),c},_drawMarker:function(t,n){var a=this;if(this._imageLookup||(this._imageLookup={}),n||(n=a._map.latLngToContainerPoint(t.getLatLng())),t.canvas_img)a._drawImage(t,n);else if(a._imageLookup[t.options.icon.options.iconUrl])t.canvas_img=a._imageLookup[t.options.icon.options.iconUrl][0],!1===a._imageLookup[t.options.icon.options.iconUrl][1]?a._imageLookup[t.options.icon.options.iconUrl][2].push([t,n]):a._drawImage(t,n);else{var i=new Image;(i=new Image).src=t.options.icon.options.iconUrl,t.canvas_img=i,a._imageLookup[t.options.icon.options.iconUrl]=[i,!1,[[t,n]]],i.onload=function(){a._imageLookup[t.options.icon.options.iconUrl][1]=!0,a._imageLookup[t.options.icon.options.iconUrl][2].forEach(function(t){a._drawImage(t[0],t[1])})}}},_drawImage:function(t,n){this._context.drawImage(t.canvas_img,n.x-t.options.icon.options.iconAnchor[0],n.y-t.options.icon.options.iconAnchor[1],t.options.icon.options.iconSize[0],t.options.icon.options.iconSize[1])},_reset:function(){var n=this._map.containerPointToLayerPoint([0,0]);t.DomUtil.setPosition(this._canvas,n);var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y,this._redraw()},_redraw:function(t){if(this._map){var n=this;t&&this._context.clearRect(0,0,this._canvas.width,this._canvas.height);var a=[];n._latlngMarkers.dirty/n._latlngMarkers.total>=.1&&(n._latlngMarkers.all().forEach(function(t){a.push(t)}),n._latlngMarkers.clear(),n._latlngMarkers.load(a),n._latlngMarkers.dirty=0,a=[]);var i=n._map.getBounds();n._latlngMarkers.search({minX:i.getWest(),minY:i.getSouth(),maxX:i.getEast(),maxY:i.getNorth()}).forEach(function(t){var i=n._map.latLngToContainerPoint(t.data.getLatLng()),e=t.data.options.icon.options.iconSize,o=e[0]/2,r=e[1]/2;a.push({minX:i.x-o,minY:i.y-r,maxX:i.x+o,maxY:i.y+r,data:t.data}),n._drawMarker(t.data,i)}),this._markers.clear(),this._markers.load(a)}},_initCanvas:function(){this._canvas=t.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer");var n=t.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this._canvas.style[n]="50% 50%";var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y,this._context=this._canvas.getContext("2d");var i=this._map.options.zoomAnimation&&t.Browser.any3d;t.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(i?"animated":"hide"))},_updateOptions:function(){},addOnClickListener:function(t){this._onClickListeners.push(t)},addOnHoverListener:function(t){this._onHoverListeners.push(t)},_executeListeners:function(t){var n=this,a=t.containerPoint.x,i=t.containerPoint.y;n._openToolTip&&(n._openToolTip.closeTooltip(),delete n._openToolTip);var e=this._markers.search({minX:a,minY:i,maxX:a,maxY:i});e&&e.length>0?(n._map._container.style.cursor="pointer","click"===t.type&&(e[0].data.getPopup()&&e[0].data.openPopup(),n._onClickListeners.forEach(function(n){n(t,e)})),"mousemove"===t.type&&(e[0].data.getTooltip()&&(n._openToolTip=e[0].data,e[0].data.openTooltip()),n._onHoverListeners.forEach(function(n){n(t,e)}))):n._map._container.style.cursor=""}});t.canvasIconLayer=function(t){return new n(t)}}},function(t,n,a){var i=a(3);window.L.CanvasIconLayer=i(L)}]);